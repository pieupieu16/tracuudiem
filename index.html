<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tra cứu điểm</title>
  <!-- CSS giữ nguyên như trước -->
</head>
<body>
  <div class="container">
    <h2>Tra cứu điểm học sinh</h2>
    <div class="input-group">
      <input type="text" id="id" placeholder="Mã học sinh" required>
    </div>
    <div class="input-group">
      <input type="password" id="pass" placeholder="Mật khẩu" required>
    </div>
    <button onclick="traCuu()" id="searchButton">Tra cứu</button>
    <pre id="ketqua"></pre>
  </div>

  <script>
    function traCuu() {
      const id = document.getElementById("id").value;
      const pass = document.getElementById("pass").value;
      const ketqua = document.getElementById("ketqua");
      const searchButton = document.getElementById("searchButton");
      
      ketqua.className = "";
      if (!id || !pass) {
        ketqua.textContent = "⚠️ Vui lòng nhập đầy đủ mã học sinh và mật khẩu";
        ketqua.className = "error";
        return;
      }

      // Disable button and show loading
      searchButton.disabled = true;
      searchButton.innerHTML = '<span class="loading"></span>Đang tải...';
      ketqua.textContent = "⏳ Đang tải...";

      // SỬA LẠI DÒNG NÀY: Dùng backtick (`) ở đầu và cuối
      const url = `https://script.google.com/macros/s/AKfycbzuPASjaYvCipCeeVcYxVhxoWFf-CS7cplBhvVIXvxRYOqEqyx80_9ARRpghy4S5OyY/exec?id=${id}&pass=${pass}`;

      fetch(url, {
        method: 'GET',
        mode: 'cors',
        headers: { 'Accept': 'application/json' },
        redirect: 'follow'
      })
      .then(res => {
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        return res.json();
      })
      .then(data => {
        if (data.error) {
          ketqua.textContent = "❌ " + data.error;
          ketqua.className = "error";
        } else {
          let output = "✅ Kết quả:\n";
          for (let key in data) {
            output += `${key}: ${data[key]}\n`;
          }
          ketqua.textContent = output;
          ketqua.className = "success";
        }
      })
      .catch(err => {
        ketqua.textContent = "⚠️ Lỗi kết nối hoặc API không phản hồi.";
        ketqua.className = "error";
        console.error(err);
      })
      .finally(() => {
        // Re-enable button and restore text
        searchButton.disabled = false;
        searchButton.textContent = "Tra cứu";
      });
    }

    // Thêm sự kiện nhấn Enter
    document.getElementById("pass").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        traCuu();
      }
    });
  </script>
</body>
</html>
